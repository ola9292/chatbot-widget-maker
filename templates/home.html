<!-- <html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chatbot Widget Maker</title>
    <link rel="stylesheet" href="../static/css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  </head>
  <body>
    <div id="app">
        <div class="container">

            <div class="pt-3 d-flex justify-content-center">
                <img src="../static/images/chatbot.png" alt="" class="img-fluid" style="max-width: 200px;">
            </div>

            <header class="text-center py-3 mx-auto" style="max-width: 600px;">
                <h1 class="h3 fw-bold">Chatbot Widget Maker</h1>
                <p class="lead mb-0">
                    Fill in your details and provide a detailed summary about your business. Include all information you want
                    customers to know.
                </p>
            </header>
            <div>
                <div class="mb-3">
                    <label for="exampleFormControlInput1" class="form-label">Business Name</label>
                    <input v-model="name" type="text" class="form-control" id="exampleFormControlInput1" placeholder="Sole Tech">
                </div>
                <div class="mb-3">
                    <label for="exampleFormControlInput1" class="form-label">Business Email</label>
                    <input v-model="email" type="text" class="form-control" id="exampleFormControlInput1" placeholder="soletech@gmail.com">
                </div>
                <div class="mb-3">
                    <label for="exampleFormControlTextarea1" class="form-label">Business Details</label>
                    <textarea v-model="summary" class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                </div>
                <button @click="sendBizData" type="button" class="btn btn-primary">Get Embed Script</button>
                <div v-if="loading && !link" class="mt-3">
                    <p>Loading...</p>
                </div>
                <div v-show="link" class="mt-3 alert alert-primary" role="alert">
                    { link }
                </div>
            </div>
        </div>
        
    </div>
    
    <script>
        const { createApp } = Vue

        createApp({
            data() {
                return {
                    message: 'Hello Vue!',
                    name:null,
                    summary:null,
                    email:null,
                    link:null,
                    loading:false
                }
            },
            delimiters: ['{','}'],
            methods:{
                async sendBizData(){
                    if(this.name && this.summary && this.email){
                        const url = "http://127.0.0.1:5000/save-data";
                        try {
                            this.loading = true
                            const response = await fetch(url, {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify({ 
                                    name: this.name,
                                    summary: this.summary,
                                    email: this.email
                                }),
                            });
                            if (!response.ok) {
                                throw new Error(`Response status: ${response.status}`);
                            }

                            const result = await response.json();
                            console.log(result);
                            this.email = null
                            this.summary = null
                            this.name = null
                            this.loading = false
                            this.link = result.script_url
                        } catch (error) {
                            console.error(error.message);
                        }
                    }else{
                        alert('enter name, email and business details')
                    }
                }
            }
        }).mount('#app')
    </script>
  </body>
</html>-->


{% extends "base.html" %}

{% block content %}
<div id="app">
    <div class="container">

        <div class="pt-3 d-flex justify-content-center">
            <img src="../static/images/chatbot.png" alt="" class="img-fluid" style="max-width: 200px;">
        </div>

        <header class="text-center py-3 mx-auto" style="max-width: 600px;">
            <h1 class="h3 fw-bold">Chatbot Widget Maker</h1>
            <p class="lead mb-0">
                Fill in your details and provide a detailed summary about your business. Include all information you
                want
                customers to know.
            </p>
        </header>
        <div>
            <div class="mb-3">
                <label for="exampleFormControlInput1" class="form-label">Business Name</label>
                <input v-model="name" type="text" class="form-control" id="exampleFormControlInput1"
                    placeholder="Sole Tech">
            </div>
            <div class="mb-3">
                <label for="exampleFormControlInput1" class="form-label">Business Email</label>
                <input v-model="email" type="text" class="form-control" id="exampleFormControlInput1"
                    placeholder="soletech@gmail.com">
            </div>
            <div class="mb-3">
                <label for="exampleFormControlTextarea1" class="form-label">Business Details</label>
                <textarea v-model="summary" class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
            </div>
            <button @click="sendBizData" type="button" class="btn btn-primary">Get Embed Script</button>
            <div v-if="loading && !link" class="mt-3">
                <p>Loading...</p>
            </div>
            <div v-show="link" class="mt-3 alert alert-primary" role="alert">
                { link }
            </div>
        </div>
    </div>

</div> 

<script>
    const { createApp } = Vue

    createApp({
        data() {
            return {
                message: 'Hello Vue!',
                name: null,
                summary: null,
                email: null,
                link: null,
                loading: false
            }
        },
        delimiters: ['{', '}'],
        methods: {
            async sendBizData() {
                if (this.name && this.summary && this.email) {
                    const url = "http://127.0.0.1:5000/save-data";
                    try {
                        this.loading = true
                        const response = await fetch(url, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({
                                name: this.name,
                                summary: this.summary,
                                email: this.email
                            }),
                        });
                        if (!response.ok) {
                            throw new Error(`Response status: ${response.status}`);
                        }

                        const result = await response.json();
                        console.log(result);
                        this.email = null
                        this.summary = null
                        this.name = null
                        this.loading = false
                        this.link = result.script_url
                    } catch (error) {
                        console.error(error.message);
                    }
                } else {
                    alert('enter name, email and business details')
                }
            }
        }
    }).mount('#app')
</script>
{% endblock %}